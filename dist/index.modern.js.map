{"version":3,"file":"index.modern.js","sources":["../src/useLocalStorage/index.js"],"sourcesContent":["import { useEffect, useState } from 'react'\nimport md5 from 'blueimp-md5'\n\nexport const hash = (object) => md5(JSON.stringify(object))\n\nconst PREFIX = '__use_local_storage_state_hook'\n\nconst getItem = (key) => {\n  try {\n    const value = window.localStorage.getItem(key)\n    if (value) {\n      return JSON.parse(value)\n    }\n  } catch (error) {\n    console.error('error in useLocalStorageState: ', error)\n  }\n\n  return undefined\n}\n\nconst setItem = (key, value) => {\n  window.localStorage.setItem(key, JSON.stringify(value))\n}\n\nconst useLocalStorageState = (keyName, initialValue) => {\n  const hashKey = `${PREFIX}__initial_value_hash__${keyName}`\n  const valueKey = `${PREFIX}__value__${keyName}`\n  const [hasSetState, setHasSetState] = useState(false)\n  const [state, setState] = useState(\n    (typeof window !== 'undefined' && getItem(valueKey)) ||\n      (initialValue instanceof Function ? initialValue() : initialValue)\n  )\n\n  const initialValueHash =\n    initialValue === undefined ? undefined : hash(initialValue)\n  useEffect(() => setState(initialValue), [initialValueHash])\n\n  useEffect(() => {\n    setItem(hashKey, initialValueHash)\n  }, [hashKey, initialValueHash])\n\n  useEffect(() => {\n    if (hasSetState) {\n      setItem(valueKey, state)\n    } else {\n      setState(\n        () =>\n          getItem(valueKey) ||\n          (initialValue instanceof Function ? initialValue() : initialValue)\n      )\n      setHasSetState(true)\n    }\n  }, [keyName, hasSetState, initialValue, state])\n\n  return [state, setState]\n}\n\nexport default useLocalStorageState\n"],"names":["PREFIX","getItem","key","value","window","localStorage","JSON","parse","error","console","setItem","stringify","keyName","initialValue","hashKey","valueKey","hasSetState","setHasSetState","useState","state","setState","Function","initialValueHash","undefined","md5","useEffect"],"mappings":"iFAKMA,EAAS,iCAETC,EAAWC,IACf,IACE,MAAMC,EAAQC,OAAOC,aAAaJ,QAAQC,GAC1C,GAAIC,EACF,OAAOG,KAAKC,MAAMJ,GAEpB,MAAOK,GACPC,QAAQD,MAAM,kCAAmCA,KAM/CE,EAAU,CAACR,EAAKC,KACpBC,OAAOC,aAAaK,QAAQR,EAAKI,KAAKK,UAAUR,mBAGrB,CAACS,EAASC,KACrC,MAAMC,EAAW,GAAEd,0BAA+BY,IAC5CG,EAAY,GAAEf,aAAkBY,KAC/BI,EAAaC,GAAkBC,GAAS,IACxCC,EAAOC,GAAYF,EACL,oBAAXd,QAA0BH,EAAQc,KACvCF,aAAwBQ,SAAWR,IAAiBA,IAGnDS,OACaC,IAAjBV,OAA6BU,EA/BDC,EAAIlB,KAAKK,UA+BSE,IAoBhD,OAnBAY,EAAU,IAAML,EAASP,GAAe,CAACS,IAEzCG,EAAU,KACRf,EAAQI,EAASQ,IAChB,CAACR,EAASQ,IAEbG,EAAU,KACJT,EACFN,EAAQK,EAAUI,IAElBC,EACE,IACEnB,EAAQc,KACPF,aAAwBQ,SAAWR,IAAiBA,IAEzDI,GAAe,KAEhB,CAACL,EAASI,EAAaH,EAAcM,IAEjC,CAACA,EAAOC"}